### æ±‡ç¼–ä½¿ç”¨èµ„æº

æ±‡ç¼–ä½¿ç”¨èµ„æºçš„æ–¹å¼å’ŒCçš„ä¸€æ ·,ä¹Ÿæ˜¯æŠŠèµ„æºæ–‡ä»¶ rc ç¼–è¯‘æˆ  **res** å†é“¾æ¥è¿›å»,æ±‡ç¼–æ²¡æœ‰è‡ªå·±çš„èµ„æºç¼–è¾‘å™¨,éœ€è¦å€ŸåŠ©  vc6.0æˆ–è€… vs

ä¸»è¦æ˜¯æŠŠ  å¤´æ–‡ä»¶ .h è½¬åŒ–ä¸ºå¯¹åº”çš„ .inc

#### ä½¿ç”¨vc6.0å»ºç«‹èµ„æºæ–‡ä»¶

![img](./notesimg/1653114806937-9be049e1-1a07-4a2a-a9d9-6e827f52e167.png)

![img](./notesimg/1653115098065-a3726add-8066-4d47-8809-7c108a587bc0.png)

![img](./notesimg/1653115127377-b51b4db3-44b2-4427-ae50-4beb2eed08de.png)

![img](./notesimg/1653115360355-0f1ce451-f1e3-44f7-8012-2d31bbc9ec93.png)



![img](./notesimg/1653115446902-eaf75ab8-458c-495a-aa0d-b6384bbfa500.png)

![img](./notesimg/1653116701676-b2171544-da6d-4b5b-a0da-af3d20ba4a6c.png)

![img](./notesimg/1653117009592-9b5b7dd9-b893-44a4-ae18-9897326a609d.png)



#### ç”¨vså»ºç«‹èµ„æºæ–‡ä»¶

1.  æ–°å»ºä¸€ä¸ªæ¡Œé¢å‘å¯¼

![img](./notesimg/1653121559376-b10ad7b4-0336-4a72-a813-53c7c42de48c.png)

![img](./notesimg/1653121593498-82cbb51e-ec94-40d0-ad23-fe0189594dfa.png)

ç”Ÿæˆæ–‡ä»¶ä¹‹å,å†æ‰“å¼€ rc æ–‡ä»¶,ç”Ÿæˆä¸º

![img](./notesimg/1653122349635-71a0397a-cf52-46a5-9a4c-e6b01bfb4530.png)

![img](./notesimg/1653122383860-c65bda64-d39d-4732-805e-157e594b3f22.png)

ç¼–è¯‘é“¾æ¥æ–‡ä»¶æ—¶è¦è®²èµ„æºæ–‡ä»¶åŠ è¿›å»

```
ml /c /coff %1.asm
if errorlevel 1 goto err
rc %1.rc   ;å¦‚æœç”¨çš„æ˜¯æ˜¯vsè‡ªå·±ç”Ÿæˆçš„ resæ–‡ä»¶,å°±ä¸éœ€è¦
if errorlevel 1 goto err
link /subsystem:windows %1.obj %1.res
if errorlevel 1 goto err
OllyICE.exe %1.exe
:err
pause
```

 ![img](./notesimg/1653117571722-9a66ee9c-d640-4fa6-bf11-d93a8fd4ff2d.png)

æ±‡ç¼–ä»£ç 

```
.386
.model flat, stdcall
option casemap:none

include windows.inc
include user32.inc
include kernel32.inc

;å¼•å…¥èµ„æºçš„å¤´æ–‡ä»¶
include resource.inc

includelib user32.lib
includelib kernel32.lib

.data


.code

;æ‰“å¼€çª—å£çš„è¿‡ç¨‹å‡½æ•°
DialogProc proc  hwndDlg:HWND,    uMsg:UINT,   wParam:WPARAM,  lParam:LPARAM
    .IF uMsg == WM_COMMAND
        mov eax, wParam
        .IF ax == BTN_TEST
            ;è°ƒç”¨å¼¹çª—çš„å‡½æ•°
            invoke MessageBox, NULL, NULL, NULL, MB_OK
        .ENDIF
    .ELSEIF uMsg == WM_CLOSE
        invoke EndDialog, hwndDlg, 0
    .ENDIF

    mov eax, FALSE  ;è¿”å›ç»“æœ
    ret
DialogProc endp


WinMain proc hInstance:HINSTANCE 
    
    ;æ‰“å¼€çª—å£å‡½æ•°  å®ä¾‹å¥æŸ„å¿…é¡»ç»™,ä¸ç„¶æ‰¾ä¸åˆ°èµ„æº 
    invoke DialogBoxParam, hInstance, DLG_TEST, NULL, offset DialogProc, 0

    ret
WinMain endp



START:
    invoke GetModuleHandle, NULL
    invoke WinMain, eax
    invoke ExitProcess, 0

end START
```

### ä½¿ç”¨Cåº“

#### åŠ¨æ€åº“ä½¿ç”¨

![img](./notesimg/1653123146662-2e3f8952-6ac8-4a09-9700-6b47d5f6deb9.png)

å¯ä»¥çœ‹å‡º,Cåº“å‡½æ•°å£°æ˜ åœ¨ msvcrt.incä¸­  å¹¶åœ¨å‰é¢åŠ   crt_

![img](./notesimg/1653123177058-1959e571-a6b6-409d-a407-e3c54155f69d.png)

![img](./notesimg/1653123256435-f8eceb81-49bc-4f7b-a60b-ffdfe7a8eb4f.png)

```
.386
.model flat, stdcall
option casemap:none

include windows.inc
include user32.inc
include kernel32.inc

include msvcrt.inc   ;cåº“å¤´æ–‡ä»¶

includelib user32.lib
includelib kernel32.lib

includelib msvcrt.lib  ;cåº“å®ç°æ–‡ä»¶


.data
    g_szFmt db "%s %d %08X", 0dh, 0ah, 0
    g_sz db "è¿™æ˜¯æµ‹è¯•", 0
    
.code
main proc C

    invoke printf, offset g_szFmt, offset g_sz, 4096, 4096
    ;invoke strlen, offset g_sz
    
    ret
main endp


START:
    invoke main
    invoke ExitProcess, 0
end START
```

![image.png](./notesimg/1653124359793-83e1e23d-c696-4258-9461-8877b7fe54d0.png)



 é™æ€åº“ä½¿ç”¨ 

```
.386
.model flat, stdcall
option casemap:none

include windows.inc
include user32.inc
include kernel32.inc

includelib user32.lib
includelib kernel32.lib

includelib libc.lib    ;Cåº“çš„é™æ€åº“

public main           ;ä½¿ç”¨é™æ€åº“å¿…ç”¨è¦æœ‰ mainå‡½æ•°

printf PROTO C :VARARG     ; å‡½æ•°å£°æ˜ VARARG  å˜å‚ç±»å‹
strlen PROTO C :DWORD      ; å‡½æ•°å£°æ˜

.data
    g_szFmt db "%s %d %08X", 0dh, 0ah, 0
    g_sz db "è¿™æ˜¯æµ‹è¯•", 0
    
.code
main proc C   ;è°ƒç”¨çº¦å®šå¿…é¡»æ˜¯c

    invoke strlen, offset g_sz    ;è°ƒç”¨cåº“å‡½æ•°
    
    ret
main endp


START:
    invoke main   ;è°ƒç”¨mainå‡½æ•°
    invoke ExitProcess, 0
end START
```

### æ±‡ç¼–å’ŒCçš„äº’è°ƒ

```
ml /c /coff test.asm

link /subsystem:console test.obj
link /subsystem:windows test.obj
```

#### ä½¿ç”¨objæ–‡ä»¶

ä»è¯­æ³•ä¸Šæ¥å°†,cå’Œæ±‡ç¼–çš„è¯­æ³•æ˜¯ç›¸äº’ä¸å…¼å®¹çš„,æ‰€ä»¥æƒ³åœ¨æºç ä¸Šè¿›è¡Œç›¸äº’é—´çš„è°ƒç”¨æ˜¯ä¸å¯èƒ½çš„äº‹æƒ…, æ‰€ä»¥åªèƒ½é€€è€Œæ±‚å…¶æ¬¡ ä½¿ç”¨objæ–‡ä»¶, æŠŠ c çš„ objæ–‡ä»¶ç»™æ±‡ç¼–å»ç”¨,æŠŠ æ±‡ç¼–çš„ obj æ–‡ä»¶ ç»™ c å»ç”¨

##### cè°ƒç”¨æ±‡ç¼–çš„ objæ–‡ä»¶

```
.386
.model flat, stdcall
option casemap:none

include windows.inc
include user32.inc
include kernel32.inc

includelib user32.lib
includelib kernel32.lib


.data
    g_szFmt db "%s %d %08X", 0dh, 0ah, 0
    g_sz db "è¿™æ˜¯æµ‹è¯•", 0
    
.code

TestFunc PROC  sz:dword
    invoke MessageBox,NULL,sz,offset  g_sz,MB_OK  ;è°ƒç”¨å¼¹çª—,æ˜¾ç¤ºä¼ å…¥çš„å­—ç¬¦ä¸²
    ret
TestFunc ENDP

;é˜²æ­¢ç¨‹åºæŠŠ  START å½“åšç¨‹åºå…¥å£,ç›´æ¥é€€å‡ºç¨‹åº
;START:
    ;invoke ExitProcess,0   ;é€€å‡ºç¨‹åº
;end START

end  
```

æŸ¥çœ‹ ç”Ÿæˆçš„obj æ–‡ä»¶, æˆ‘ä»¬çš„ å‡½æ•°çš„åå­—

![img](./notesimg/1653125939590-e03c8747-5102-4143-893a-2f497b5509e7.png)

è°ƒç”¨  

1.  æ–°å»ºä¸€ä¸ª 32ä½çš„æ¡Œé¢åº”ç”¨ç¨‹åº

![img](./notesimg/1653126006842-b9bc546c-9c8d-44f7-880f-30337ca24311.png)

1.  æŠŠobjæ–‡ä»¶å¤åˆ¶åˆ°å·¥ç¨‹ç›®å½•ä¸‹
2.  å†å¯¼å…¥.bobjæ–‡ä»¶

![img](./notesimg/1653126333853-bc2c18ec-20fc-4dfa-acba-0e5d40980644.png)

![img](./notesimg/1653126416290-1988f446-4c11-4dba-b377-8ff430c9635f.png)

1.  å»æ‰é¢„ç¼–è¯‘å¤´

![img](./notesimg/1653126933316-c794bdfd-c771-418d-9219-f2b199797420.png)

```
extern "C" void __stdcall TestFunc(char* sz);   //å¯¹å‡½æ•°è¿›è¡Œå£°æ˜,æ³¨æ„è°ƒç”¨çº¦å®š


int main(int argc, char* argv[])
{
  
  TestFunc("ä½ å¥½");   //è°ƒç”¨æ±‡ç¼–objé‡Œé¢çš„å‡½æ•°

  printf("Hello World!\n");
  return 0;
}

```

![img](./notesimg/1653127002300-2ff56624-c61e-41e1-af40-7c990fbe2f36.png)



##### ç”¨vsè°ƒç”¨ æ±‡ç¼–obj

````
.386
.model flat, stdcall
option casemap:none

include windows.inc
include user32.inc
include kernel32.inc

includelib user32.lib
includelib kernel32.lib

Func proto c sz:DWORD  ;å°†å‡½æ•°å£°æ˜æ”¹æˆæ±‡ç¼–å½¢å¼

.data
    g_szFmt db "%s %d %08X", 0dh, 0ah, 0
    g_sz db "è¿™æ˜¯æµ‹è¯•", 0
    
.code

TestFunc PROC  sz:dword
    invoke MessageBox,NULL,sz,offset  g_sz,MB_OK
    ret
TestFunc ENDP

end


````

æŠŠæ±‡ç¼–ç”Ÿæˆçš„ obj æ–‡ä»¶ æ”¾å…¥é¡¹ç›®



![image.png](./notesimg/1653129657700-6b7b019d-7701-4f9a-a1be-c7d53be678f0.png)





![image.png](./notesimg/1653130576344-4c166de7-fb34-4012-adb0-8542ad528b49.png)





![image.png](./notesimg/1653130589363-f8461d1e-3683-4032-9663-e897f40ca999.png)



 æ±‡ç¼–ä½¿ç”¨Cè¯­è¨€çš„ obj 

1æ–°å»ºä¸€ä¸ªcçš„æºæ–‡ä»¶



![image.png](./notesimg/1653127181008-1af54761-fb42-497b-b383-e3047a49721c.png)



2å–æ¶ˆé¢„ç¼–è¯‘å¤´



![image.png](./notesimg/1653127398874-26da2229-ae28-45be-a0f3-5d6a93c01b65.png)

```
#include <windows.h>

void Func(char* sz)
{

  MessageBox(NULL,sz,"è¿™æ˜¯cå‡½æ•°",MB_OK);
}
```

![img](./notesimg/1653127455711-cffdd546-a7cc-47a3-bce4-3eb15b644ef5.png)

![img](./notesimg/1653127526616-f7e2f23b-feaa-4afb-a7c6-525e0ea928ed.png)

æŠŠ objæ–‡ä»¶æ”¾åˆ°æ±‡ç¼–ä»£ç åŒç›®å½•

```
.386
.model flat, stdcall
option casemap:none

include windows.inc
include user32.inc
include kernel32.inc

includelib user32.lib
includelib kernel32.lib


Func proto c sz:DWORD  ;å°†å‡½æ•°å£°æ˜æ”¹æˆæ±‡ç¼–å½¢å¼


.data
    g_szFmt db "%s %d %08X", 0dh, 0ah, 0
    g_sz db "è¿™æ˜¯æµ‹è¯•", 0
    
.code

;è°ƒç”¨ c çš„objæ–‡ä»¶å¿…é¡»æœ‰,è™½ç„¶æ²¡ä»€ä¹ˆç”¨
main proc c
    ret
main endp

TestFunc PROC  sz:dword
    invoke MessageBox,NULL,sz,offset  g_sz,MB_OK
    ret
TestFunc ENDP

START:
    invoke Func, offset g_sz
    invoke ExitProcess,0   ;é€€å‡ºç¨‹åº
end START


```

![img](./notesimg/1653129150282-490b2dfa-b4b5-4f8f-9945-2b316efb9112.png)

è§£å†³åŠæ³•,æŠŠ vs æˆ–è€…vc6çš„ lib åŠ å…¥ç¯å¢ƒå˜é‡ 

![img](./notesimg/1653268156407-d15a5cdc-fc15-4dd1-aedb-ad6da2f125fa.png)

###### æ±‡ç¼–ä½¿ç”¨  vs çš„ obj

åœ¨vsé¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ª   Func.c æ–‡ä»¶ ä»£ç å¦‚ä¸‹,ç”Ÿæˆè§£å†³æ–¹æ¡ˆ

```
#include <windows.h>

void Func(char* sz)
{

    MessageBox(NULL, sz, "è¿™æ˜¯cå‡½æ•°", MB_OK);
}
```

æŠŠobjæ–‡ä»¶æ”¾åˆ°åŒç›®å½•

```
.386
.model flat, stdcall
option casemap:none

include windows.inc
include user32.inc
include kernel32.inc

includelib user32.lib
includelib kernel32.lib

Func proto c sz:DWORD  ;å°†å‡½æ•°å£°æ˜æ”¹æˆæ±‡ç¼–å½¢å¼

.data
    g_szFmt db "%s %d %08X", 0dh, 0ah, 0
    g_sz db "è¿™æ˜¯æµ‹è¯•", 0
    
.code

;è°ƒç”¨ c çš„objæ–‡ä»¶å¿…é¡»æœ‰,è™½ç„¶æ²¡ä»€ä¹ˆç”¨
main proc c
    ret
main endp

TestFunc PROC  sz:dword
    invoke MessageBox,NULL,sz,offset  g_sz,MB_OK
    ret
TestFunc ENDP

START:
    invoke Func, offset g_sz
    invoke ExitProcess,0   ;é€€å‡ºç¨‹åº
end START

```

æ­¤æ—¶å»ç¼–è¯‘é“¾æ¥é¡¹ç›® ä¼šæœ‰ä¸€å¤§å † å¤–éƒ¨ç¬¦å·æ‰¾ä¸åˆ°, è¿™äº› åº“æ˜¯vs çš„ ,è§£å†³åŠæ³•æ˜¯æŠŠè¿™äº›åº“åŠ è¿›æ¥,æˆ–è€…ä½¿ç”¨ vs çš„å‘½ä»¤æç¤ºç¬¦.å¾ˆéº»çƒ¦,è¿˜è¦å…³æ‰ä¸€å †çš„æ£€æŸ¥,æœ€å¥½çš„æ–¹æ³•ä½¿ç”¨dll



#### ä½¿ç”¨dll

dllçš„æ¥å£æ˜¯å¾ˆæ ‡å‡†çš„,ä»dllå‡ºç°ä¸ºæ­¢,åŸºæœ¬æ²¡å˜è¿‡

##### æ±‡ç¼–ä½¿ç”¨ C çš„ dll

1.  ç”¨vsåˆ›å»ºä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“

    ```
    // dllmain.cpp : å®šä¹‰ DLL åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚
    #include "pch.h"
    
    
    #include <windows.h>
    
    extern "C" void Func(char* sz)   //å£°æ˜å‡½æ•°å’Œè°ƒç”¨çº¦å®š
    {
    
        MessageBoxA(NULL, sz, "è¿™æ˜¯cå‡½æ•°", MB_OK);
    }
    
    
    
    BOOL APIENTRY DllMain(HMODULE hModule,
        DWORD  ul_reason_for_call,
        LPVOID lpReserved
    )
    {
        switch (ul_reason_for_call)
        {
        case DLL_PROCESS_ATTACH:
        case DLL_THREAD_ATTACH:
        case DLL_THREAD_DETACH:
        case DLL_PROCESS_DETACH:
            break;
        }
        return TRUE;
    }
    
    ```

    å¯¼å‡ºå‡½æ•°

    ![img](./notesimg/1653132014234-6a8c1c6c-b8a2-470f-811b-a7107dbb298d.png)

    æŠŠç”Ÿæˆ çš„  dll  å’Œ lib æ–‡ä»¶  æ”¾åˆ°æ±‡ç¼–åŒç›®å½•ä¸‹

    ```
    .386
    .model flat, stdcall
    option casemap:none
    
    include windows.inc
    include user32.inc
    include kernel32.inc
    
    includelib  MyDll.lib ;å¯¼å…¥libåº“
    
    includelib user32.lib
    includelib kernel32.lib
    
    Func proto c sz:DWORD  ;å°†å‡½æ•°å£°æ˜æ”¹æˆæ±‡ç¼–å½¢å¼
    
    .data
        g_szFmt db "%s %d %08X", 0dh, 0ah, 0
        g_sz db "è¿™æ˜¯æµ‹è¯•", 0
        
    .code
    
    ;è°ƒç”¨ c çš„objæ–‡ä»¶å¿…é¡»æœ‰,è™½ç„¶æ²¡ä»€ä¹ˆç”¨
    main proc c
        ret
    main endp
    
    TestFunc PROC  sz:dword
        invoke MessageBox,NULL,sz,offset  g_sz,MB_OK
        ret
    TestFunc ENDP
    
    START:
        invoke Func, offset g_sz
        invoke ExitProcess,0   ;é€€å‡ºç¨‹åº
    end START
    ```

    ![img](./notesimg/1653132370223-3b054a66-a9a4-47bb-a043-58f124550729.png)

    ![img](./notesimg/1653132335050-8715f016-4379-4096-b1bd-c5b3793a1248.png)

    ##### Cä½¿ç”¨æ±‡ç¼–çš„DLL

    æ±‡ç¼–ä¹Ÿå¯ä»¥å†™æˆdll    .æ³¨æ„å­—ç¬¦é›†

    ```
    .386
    .model flat, stdcall
    option casemap:none
    
    include windows.inc
    include user32.inc
    include kernel32.inc
    
    includelib user32.lib
    includelib kernel32.lib
    
    .data
        g_sz db "è¿™æ˜¯æµ‹è¯•", 0
    
    .code 
    TestFunc proc sz:DWORD
        invoke MessageBox, NULL, sz, offset g_sz, MB_OK 
        ret
    TestFunc endp
    
    ; dll å¿…é¡»è¦æœ‰ DllMain 
    DllMain proc hinstDLL:HINSTANCE,  fdwReason:DWORD, lpvReserved:LPVOID
    
        mov eax, TRUE
        ret
    DllMain endp
    
    end DllMain   ;DllMainä¸€èˆ¬ä½œä¸ºå‡½æ•°å…¥å£ç‚¹
    
    ```

    

æ–°å»ºä¸€ä¸ªdef æ–‡ä»¶å¯¼å‡ºå‡½æ•°



![image.png](./notesimg/1653132799718-8e9c5fe4-250c-448c-a8d3-5430ee5a110d.png)



![image.png](./notesimg/1653132997705-be41bc4a-7e8d-493f-a724-f9be5ee3daa2.png)



æ­¤æ—¶dllä¸­å¹¶æ²¡æœ‰å¯¼å‡ºå‡½æ•°,å› ä¸ºæ²¡æœ‰å‘Šè¯‰é“¾æ¥å™¨å»ç”¨å®ƒ



![image.png](./notesimg/1653133077342-80eb10d7-9d03-498c-a2b1-83c393dc821f.png)





![image.png](./notesimg/1653133295727-df2fbefc-bfa6-471a-bfa5-bb3706b7bac7.png)



![image.png](./notesimg/1653133340272-99cb0ef0-7629-4fe8-bb2d-7e8efb91ade2.png)



è¿™ä¸ªdllå°±å¯ä»¥ç»™ cç¨‹åºç”¨äº†

æŠŠ ç”Ÿæˆ çš„ dll å’Œlib æ”¾åˆ°æ­£ç¡®ä½ç½® 

```
#include "framework.h"
#include "Project2.h"


#pragma comment(lib, "asmdll.lib")  ä½¿ç”¨ç”Ÿæˆçš„ libåº“
extern "C" void __stdcall TestFunc(char* sz);


int APIENTRY wWinMain(_In_ HINSTANCE hInstance,
    _In_opt_ HINSTANCE hPrevInstance,
    _In_ LPWSTR    lpCmdLine,
    _In_ int       nCmdShow)
{
    TestFunc((char*)"ä½ å¥½");
}

```

![img](./notesimg/1653133619591-4d4e249d-eb5b-40a8-bee7-5cf90f5b8c88.png)

### å†…è”æ±‡ç¼–

#### å†…è”

åœ¨c,c++ä¸­å†™æ±‡ç¼–ä»£ç   ,åœ¨å†…è”æ±‡ç¼–ä¸­,å®æ±‡ç¼–æ˜¯æ— æ³•ä½¿ç”¨çš„,ä½†æ˜¯éƒ¨åˆ†ä¼ªæŒ‡ä»¤æ˜¯å¯ä»¥ç”¨çš„,è€Œä¸”åªæœ‰ 32ä½ç¨‹åºå¯ä»¥å†™,64ä½ç¨‹åºæ˜¯æ— æ³•å†…è”æ±‡ç¼–çš„

å½“æˆ‘ä»¬æƒ³æŠŠæŸä¸ªå‡½æ•°æ³¨å…¥åˆ°å¯¹æ–¹è¿›ç¨‹é‡Œé¢,è¿™æ ·å°±è¦æ±‚æˆ‘ä»¬çš„ä»£ç æ˜¯çº¯æ±‡ç¼–çš„,å› ä¸ºä¸€æ—¦ç”¨åˆ°vsçš„ä»£ç ,vså°±ä¼šåŠ ä¸€å †æ£€æŸ¥

æ ¼å¼:   å…³é”®å­—    __asm

```
 __asm         mov eax, eax
  __asm        mov eax, n
  __asm {
        mov eax, n0
        mov n0, 10

        push MB_OK
        push sz
        push NULL
        push NULL
        call MessageBoxA

        mov eax, size n
        mov eax, length n
        mov eax, offset wWinMain
    }


```



![img](./notesimg/1653133892842-b428ae71-1c0f-4076-8da3-a405c341f180.png)

```
// Project2.cpp : å®šä¹‰åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚
//

#include "framework.h"
#include "Project2.h"
#pragma comment(lib, "asmdll.lib")
extern "C" void __stdcall TestFunc(char* sz);


void TestAsm(int n, char* sz)
{
    int n0 = 9;
    __asm {
        mov eax, eax
        mov eax, n
        mov eax, n0
        mov n0, 10

        push MB_OK
        push sz
        push NULL
        push NULL
        call MessageBoxA   //æ±‡ç¼–é‡Œé¢è°ƒå‡½æ•°  ,å®æ±‡ç¼–æ˜¯æ— æ³•ä½¿ç”¨çš„

        //ä½¿ç”¨ä¼ªæŒ‡ä»¤
        mov eax, size n
        mov eax, length n
        mov eax, offset wWinMain
    }
}

//è£¸å‡½æ•°
__declspec(naked) void Test(int n, char* sz)
{
    //è£¸å‡½æ•°ç”³è¯·æ ˆç©ºé—´
    __asm
    {
        push ebp
        mov ebp, esp
        sub esp, 0x40
    }

    ;è£¸å‡½æ•°ä¸å…è®¸åˆå§‹åŒ–å˜é‡
    int n0;
    float f0;
    n0 = 9;
    f0 = 3.14f;
    if (n0 == n)
    {
        MessageBoxA(NULL, NULL, NULL, NULL);
    }

    __asm
    {
        mov esp, ebp
        pop ebp
        ret
    }
}

int APIENTRY wWinMain(_In_ HINSTANCE hInstance,
    _In_opt_ HINSTANCE hPrevInstance,
    _In_ LPWSTR    lpCmdLine,
    _In_ int       nCmdShow)
{
    Test(99, (char*)"hello world");
    TestAsm(99, (char*)"hello world");
    //TestFunc((char*)"ä½ å¥½");
    return 0;
}
```

#### è£¸å‡½æ•°    __declspec(naked) 

æ­£å¸¸ä¸€ä¸ªç©ºå‡½æ•°ä»€ä¹ˆéƒ½ä¸å†™.éƒ½å›ä¼šæœ‰ä¸€äº›åˆæ•°åŒ–æ“ä½œ,ä½†æ˜¯å¦‚æœä¸è¦,å¯ä»¥å£°æ˜ å®ƒæ˜¯ä¸€ä¸ªè£¸å‡½æ•°,å°±ä¸ä¼šå¸®å…¶ç”Ÿæˆä»£ç ,éœ€è¦è‡ªå·±å»ç”Ÿæˆ

```
//è£¸å‡½æ•°
__declspec(naked) void Test(int n, char* sz)
{
    __asm
    {
        push ebp
        mov ebp, esp
        sub esp, 0x40
    }

    int n0;
    float f0;
    n0 = 9;
    f0 = 3.14f;
    if (n0 == n)
    {
        MessageBoxA(NULL, NULL, NULL, NULL);
    }

    __asm
    {
        mov esp, ebp
        pop ebp
        ret
    }
}
```

### ä½œä¸š

#### æ±‡ç¼–ç‰ˆä¿„ç½—æ–¯æ–¹å—

[ğŸ“æ±‡ç¼–ç‰ˆä¿„ç½—æ–¯æ–¹å—.zip](./æ±‡ç¼–ç‰ˆä¿„ç½—æ–¯æ–¹å—.zip)